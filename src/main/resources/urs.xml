<?xml version="1.0" encoding="UTF-8" ?>
<topology name="urs-topology" works="20" ackers="0" debug="false">	
	<spouts>
		<spout name="TestSpout" class="com.tencent.urs.spouts.TestSpout" parallelism="1">
			<tdbank_zookeeper_address>sk-zk-td1:2181,sk-zk-td2:2181,sk-zk-td3:2181,sk-zk-td4:2181,sk-zk-td5:2181</tdbank_zookeeper_address>
			<tdbank_zookeeper_timeout>10000</tdbank_zookeeper_timeout>
			<tdbank_zookeeper_connecttimeout>30000</tdbank_zookeeper_connecttimeout>
			<tdbank_zookeeper_synctime>5000</tdbank_zookeeper_synctime>
			<tdbank_zookeeper_metaroot>/meta</tdbank_zookeeper_metaroot>
			<tdbank_queue_size>100000</tdbank_queue_size>
			<tdbank_topic>ecc_51buy_real</tdbank_topic>
			<tdbank_group>urs-group-test1</tdbank_group>
			<tdbank_maxoffset>true</tdbank_maxoffset>
			<output_fields>
				<stream_id>UserAction</stream_id>
				<fields>bid,topic,qq,uid,adpos,action_type,action_time,item_id,action_result,imei,platform,lbs_info</fields>
			</output_fields>
		</spout>
	</spouts>
	
	<bolts>
		<bolt name="PretreatmentBolt" class="com.tencent.urs.bolts.PretreatmentBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>UserActionSpout</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
			
			<output_fields>
				<stream_id>UserAction</stream_id>
				<fields>bid,topic,old_qq,uid,adpos,action_type,action_time,item_id,action_result,imei,platform,lbs_info,qq,group_id</fields>
			</output_fields>	
		</bolt>

		<bolt name="TopActionBolt" class="com.tencent.urs.bolts.TopActionBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
			
			<storage_table>301</storage_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
		</bolt>
		
				
		<bolt name="ActionDetailBolt" class="com.tencent.urs.bolts.ActionDetailBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<storage_table>302</storage_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
		</bolt>
		
		<bolt name="ItemCountBolt" class="com.tencent.urs.bolts.ItemCountBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<user_count_table>303</user_count_table>
			<group_count_table>304</group_count_table>
			<dependent_table>302</dependent_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
		</bolt>
		
		<bolt name="ItemPairBolt" class="com.tencent.urs.bolts.ItemPairBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<user_count_table>305</user_count_table>
			<group_count_table>306</group_count_table>
			<dependent_table>302</dependent_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
		</bolt>
		
		<bolt name="CtrStorBolt" class="com.tencent.urs.bolts.CtrStorBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<storage_table>306</storage_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
		</bolt>
		
		<bolt name="ARCFBolt" class="com.tencent.urs.bolts.ARCFBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<item_count_table>304</item_count_table>
			<pair_count_table>306</pair_count_table>
			<dependent_table>302</dependent_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
			
			<output_fields>
				<stream_id>computer_result</stream_id>
				<fields>key,weight,alg_name</fields>
			</output_fields>
		</bolt>
		
		<bolt name="CtrBolt" class="com.tencent.urs.bolts.CtrBolt" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<dependent_table>306</dependent_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
			
			<output_fields>
				<stream_id>computer_result</stream_id>
				<fields>key,weight,alg_name</fields>
			</output_fields>
		</bolt>
		
		<bolt name="HotTopByCategory" class="com.tencent.urs.bolts.HotTopByCategory" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<item_count_table>304</item_count_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
			
			<output_fields>
				<stream_id>computer_result</stream_id>
				<fields>key,weight,alg_name</fields>
			</output_fields>
		</bolt>
		
		<bolt name="HotTopByGroupId" class="com.tencent.urs.bolts.HotTopByGroupId" parallelsim="1">
			<grouping type="field">
				<fields>qq</fields>
				<component>PretreatmentBolt</component>
				<streaming_ids>UserAction</streaming_ids>
			</grouping>
		
			<item_count_table>304</item_count_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
			
			<output_fields>
				<stream_id>computer_result</stream_id>
				<fields>key,weight,alg_name</fields>
			</output_fields>
		</bolt>
		
		<bolt name="ResultStorageBolt" class="com.tencent.urs.bolts.ResultStorageBolt" parallelsim="1">
			<grouping type="field">
				<fields>key</fields>
				<component>ARCFBolt</component>
				<streaming_ids>computer_result</streaming_ids>
			</grouping>
			
			<grouping type="field">
				<fields>key</fields>
				<component>CtrBolt</component>
				<streaming_ids>computer_result</streaming_ids>
			</grouping>
			
			<grouping type="field">
				<fields>key</fields>
				<component>HotTopByCategory</component>
				<streaming_ids>computer_result</streaming_ids>
			</grouping>
			
			<grouping type="field">
				<fields>key</fields>
				<component>HotTopByGroupId</component>
				<streaming_ids>computer_result</streaming_ids>
			</grouping>
			
		
			<dependent_table>310</dependent_table>
			<data_expiretime>259200</data_expiretime>
			<cache_expiretime>3600</cache_expiretime>
		</bolt>
		
	</bolts>
	
	<configs>
		<config>
			<key>combiner.expireTime</key>
			<value>5</value>
		</config>
	
		<config>
			<key>list.tdengine.configserver</key>
			<value>10.149.22.35:5198,10.149.24.110:5198</value>
		</config>

		<config>
			<key>list.tdengine.groupname</key>
			<value>Dummy_test_tdengine</value>
		</config>

		<config>
			<key>list.tdengine.timeout</key>
			<value>2000</value>
		</config>

		<config>
			<key>tdbank.monitor.type</key>
			<value>monitor</value>
		</config>
		
		<config>
			<key> tdbank.monitor.iplist</key>
			<value>10.208.133.235:46801;10.208.133.237:46801;10.208.133.28:46801;10.208.133.76:46801;10.208.133.84:46801;10.208.133.86:46801;10.208.134.22:46801;10.198.143.101:46801;10.198.143.105:46801;10.198.143.106:46801;10.198.143.107:46801;10.198.143.108:46801;10.198.145.230:46801;10.198.145.232:46801;10.198.146.175:46801;10.198.146.176:46801;10.198.146.177:46801;10.198.146.178:46801;10.208.134.47:46801;10.208.134.48:46801</value>
		</config>


		<config>
			<key>tdbank.monitor.systemid</key>
			<value>1057686</value>
		</config>
	
		<config>
			<key>monitor.table.query.inifid</key>
			<value>1</value>
		</config>
		
		<config>
			<key>tdbank.monitor.messageType</key>
			<value>2</value>
		</config>
		
		<config>
			<key>tdbank.monitor.flush.interval</key>
			<value>1</value>
		</config>
		
		<config>
			<key>tdbank.monitor.bid</key>
			<value>BOSS_MONITOR</value>
		</config>
		
		<config>
			<key>tdengine.config.timeout</key>
			<value>2000</value>
		</config>
	</configs>
</topology>
